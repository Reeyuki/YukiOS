<html lang="en-us">
  <head>
    <base href="https://cdn.jsdelivr.net/gh/genizy/web-port@main/deltatraveler/" />
    <meta charset="utf-8" />
    <title>Unity Web Player | DELTATRAVELER</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        border: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        background: #1f1f20;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #unity-canvas {
        background: #1f1f20;
        width: 100%;
        height: 100%;
        display: block;
      }
      #loading-text {
        position: absolute;
        top: 20px;
        width: 100%;
        text-align: center;
        color: white;
        font-size: 48px;
        font-family: cursive;
      }
    </style>
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes"
    />
  </head>
  <body>
    <div id="loading-text">LOADING... 0 MB / 244.51 MB (0%)</div>
    <canvas id="unity-canvas" tabindex="-1" width="1184" height="723"></canvas>

    <script src="Build/DELTAWEBGL.loader.js"></script>
    <script>
      const canvas = document.querySelector("#unity-canvas");
      const loadingText = document.querySelector("#loading-text");
      let totalBytes = 256389429;
      let loadedBytes = 0;

      function formatSize(bytes) {
        if (bytes > 1024 * 1024 * 1024) return (bytes / (1024 * 1024 * 1024)).toFixed(2) + " GB";
        if (bytes > 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + " MB";
        if (bytes > 1024) return (bytes / 1024).toFixed(2) + " KB";
        return bytes + " B";
      }

      async function getSize(url) {
        try {
          const res = await fetch(url, { method: "HEAD" });
          return parseInt(res.headers.get("Content-Length") || "0", 10);
        } catch {
          return 0;
        }
      }

      async function fetchWithProgress(url) {
        const response = await fetch(url);
        const reader = response.body.getReader();
        let chunks = [],
          received = 0;
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          received += value.length;
          loadedBytes += value.length;
          chunks.push(value);
          const doneText = formatSize(loadedBytes);
          const totalText = formatSize(totalBytes);
          const percent = totalBytes > 0 ? ((loadedBytes / totalBytes) * 100).toFixed(1) : "?";
          loadingText.textContent = `LOADING... ${doneText} / ${totalText} (${percent}%)`;
        }
        let fullBuffer = new Uint8Array(received);
        let offset = 0;
        for (let chunk of chunks) {
          fullBuffer.set(chunk, offset);
          offset += chunk.length;
        }
        return fullBuffer.buffer;
      }

      async function mergeFiles(parts) {
        const buffers = await Promise.all(parts.map(fetchWithProgress));
        return URL.createObjectURL(new Blob(buffers));
      }

      function getParts(file, count) {
        let parts = [];
        for (let i = 1; i <= count; i++) parts.push(file + ".part" + i);
        return parts;
      }

      (async () => {
        const dataParts = getParts("Build/DELTAWEBGL.data.unityweb", 9);
        const wasmParts = getParts("Build/DELTAWEBGL.wasm.unityweb", 5);
        const [dataUrl, wasmUrl] = await Promise.all([mergeFiles(dataParts), mergeFiles(wasmParts)]);

        createUnityInstance(canvas, {
          arguments: [],
          dataUrl: dataUrl,
          frameworkUrl: "Build/DELTAWEBGL.framework.js.unityweb",
          codeUrl: wasmUrl,
          streamingAssetsUrl: "StreamingAssets",
          companyName: "RynoGG",
          productName: "DELTATRAVELER",
          productVersion: "3.0.12.0111",
          matchWebGLToCanvasSize: true
        }).then(() => {
          loadingText.remove();
        });
      })();
    </script>
  </body>
</html>
